<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Combinaciones - Sistema Avanzado</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Preconexi√≥n para mejorar performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    
    <!-- Hojas de estilo -->
    <link rel="stylesheet" href="./styles/main.css">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üé∞</text></svg>">
    
    <!-- Estilos cr√≠ticos inline para render inicial -->
    <style>
        /* Solo lo m√≠nimo necesario para render inicial */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --bg-color: #f5f7fa;
            --text-color: #2c3e50;
        }

        /* Variables para modo oscuro */
        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --bg-card: #2d2d2d;
            --text-color: #f0f0f0;
            --primary-color: #4a90e2;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            opacity: 0.7;
            cursor: wait !important;
        }

        /* Estilos de carga inicial */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .main-header {
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .site-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.75rem;
            margin: 0;
            color: var(--text-color);
        }

        .section-title {
            color: var(--text-color);
        }

        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] .site-title,
        [data-theme="dark"] .section-title {
            color: #e0e0e0;
        }
    </style>
</head>
<body>
    <!-- Skip to content link para accesibilidad -->
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>

    <div class="container">
        <header class="main-header" role="banner">
            <div class="header-content">
                <h1 class="site-title">
                    <span class="site-icon" aria-hidden="true">üé∞</span>
                    Generador de Combinaciones
                </h1>
                <div class="header-controls">
                    <button id="themeToggle" class="btn-icon" 
                            title="Alternar modo oscuro/claro"
                            aria-label="Cambiar tema de color">
                        <span id="themeIcon" class="theme-icon" aria-hidden="true">üåô</span>
                    </button>
                    <button id="ver-historial" class="btn-secondary btn-icon"
                            title="Ver hist√≥rico de combinaciones">
                        <span class="btn-icon-text" aria-hidden="true">üìã</span>
                        <span class="btn-label">Hist√≥rico</span>
                    </button>
                </div>
            </div>
        </header>

        <main id="main-content" class="main-content" role="main">
            <!-- Secci√≥n de controles -->
            <section class="controls-section card" aria-labelledby="controles-titulo">
                <h2 id="controles-titulo" class="section-title">Configuraci√≥n del Generador</h2>
                
                <div class="controls-grid">
                    <div class="form-group">
                        <label for="juego" class="form-label">Tipo de Juego</label>
                        <select id="juego" class="form-select" 
                                aria-describedby="juego-desc">
                            <option value="baloto">Baloto</option>
                            <option value="mi-loto">Mi Loto</option>
                            <option value="color-loto">Color Loto</option>
                        </select>
                        <small id="juego-desc" class="form-description">
                            Selecciona el juego para el que quieres generar combinaciones
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="combinaciones" class="form-label">Cantidad</label>
                        <input type="number" id="combinaciones" class="form-input" 
                               value="5" min="1" max="100" step="1"
                               aria-describedby="combinaciones-desc">
                        <small id="combinaciones-desc" class="form-description">
                            N√∫mero de combinaciones a generar (1-100)
                        </small>
                    </div>
                </div>

                <div class="action-buttons" role="toolbar" aria-label="Acciones principales">
                    <button id="generar" class="btn-primary">
                        <span class="btn-icon-text" aria-hidden="true">üé≤</span>
                        <span>Generar Combinaciones</span>
                    </button>
                    <button id="guardar" class="btn-success">
                        <span class="btn-icon-text" aria-hidden="true">üíæ</span>
                        <span>Guardar en Hist√≥rico</span>
                    </button>
                    <button id="seleccionar-mejores" class="btn-info">
                        <span class="btn-icon-text" aria-hidden="true">‚≠ê</span>
                        <span>Seleccionar Mejores</span>
                    </button>
                    <button id="eliminar-seleccionados" class="btn-danger">
                        <span class="btn-icon-text" aria-hidden="true">üóëÔ∏è</span>
                        <span>Eliminar Seleccionados</span>
                    </button>
                    <button id="limpiar" class="btn-warning">
                        <span class="btn-icon-text" aria-hidden="true">üßπ</span>
                        <span>Limpiar Todo</span>
                    </button>
                </div>
            </section>

            <!-- Reglas del juego (din√°mico) -->
            <section id="reglas-juego" class="rules-section card" 
                     role="region" aria-labelledby="reglas-titulo">
                <h2 id="reglas-titulo" class="section-title">Reglas del Juego</h2>
                <div id="reglas-contenido">
                    <!-- Contenido cargado din√°micamente -->
                </div>
            </section>

            <!-- Tabla de resultados -->
            <section class="results-section" aria-labelledby="resultados-titulo">
                <div class="section-header">
                    <h2 id="resultados-titulo" class="section-title">
                        <span class="section-icon" aria-hidden="true">üìä</span>
                        Combinaciones Generadas
                    </h2>
                    <div class="select-all-container">
                        <input type="checkbox" id="seleccionar-todas" 
                               class="checkbox-lg"
                               aria-label="Seleccionar todas las combinaciones">
                        <label for="seleccionar-todas" class="checkbox-label">
                            Seleccionar todas
                        </label>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-responsive">
                        <table id="tabla-resultados" class="data-table" 
                               aria-describedby="tabla-desc">
                            <caption class="visually-hidden">
                                Lista de combinaciones generadas con sus estad√≠sticas
                            </caption>
                            <thead>
                                <tr>
                                    <th scope="col" class="col-checkbox">
                                        <span class="visually-hidden">Seleccionar</span>
                                    </th>
                                    <th scope="col" class="col-index">#</th>
                                    <th scope="col" class="col-combinacion">Combinaci√≥n</th>
                                    <th scope="col" class="col-extra baloto-only">Super Balota</th>
                                    <th scope="col" class="col-extra color-loto-only">Color Loto</th>
                                    <th scope="col" class="col-puntuacion">Puntuaci√≥n</th>
                                    <th scope="col" class="col-probabilidad">Probabilidad</th>
                                </tr>
                            </thead>
                            <tbody id="cuerpo-tabla">
                                <!-- Filas generadas din√°micamente -->
                                <tr class="empty-state">
                                    <td colspan="7">
                                        <div class="empty-message">
                                            <p>No hay combinaciones generadas a√∫n.</p>
                                            <p>Haz clic en "Generar Combinaciones" para comenzar.</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Panel de estad√≠sticas -->
            <section class="stats-section card" aria-labelledby="stats-titulo">
                <h2 id="stats-titulo" class="section-title">
                    <span class="section-icon" aria-hidden="true">üìà</span>
                    Estad√≠sticas
                </h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-combinaciones" aria-live="polite">0</div>
                        <div class="stat-label">Combinaciones Generadas</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="total-lotes" aria-live="polite">0</div>
                        <div class="stat-label">Lotes Guardados</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="mejor-frecuencia" aria-live="polite">-</div>
                        <div class="stat-label">N√∫mero M√°s Frecuente</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="probabilidad-promedio" aria-live="polite">-</div>
                        <div class="stat-label">Probabilidad Promedio</div>
                    </div>
                </div>
                
                <div class="stats-actions">
                    <button id="limpiar-estadisticas" class="btn-secondary btn-sm">
                        <span class="btn-icon-text" aria-hidden="true">üîÑ</span>
                        Reiniciar Estad√≠sticas
                    </button>
                </div>
            </section>

            <!-- Panel de probabilidades -->
            <section id="probabilityPanel" class="probability-section card" 
                     aria-labelledby="probability-titulo">
                <h2 id="probability-titulo" class="section-title">
                    <span class="section-icon" aria-hidden="true">üéØ</span>
                    Informaci√≥n de Probabilidades
                </h2>
                <div id="probabilityContent" class="probability-grid"></div>
            </section>
        </main>

        <footer class="main-footer" role="contentinfo">
            <div class="footer-content">
                <p class="footer-text">
                    Generador de Combinaciones ¬© 2024 - 
                    <span class="version">v1.0.0</span>
                </p>
                <p class="footer-disclaimer">
                    Esta herramienta es para entretenimiento. Los resultados son aleatorios.
                </p>
            </div>
        </footer>
    </div>

    <!-- Sistema de notificaciones -->
    <div id="notification-area" class="notification-area" 
         role="region" aria-live="polite" aria-atomic="true"></div>

    <!-- Modal del Hist√≥rico -->
    <div id="historico-modal" class="modal" role="dialog" 
         aria-labelledby="modal-titulo" aria-modal="true" hidden>
        <div class="modal-overlay" data-close-modal></div>
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="modal-titulo" class="modal-title">
                    <span class="modal-icon" aria-hidden="true">üìã</span>
                    Hist√≥rico de Combinaciones
                </h2>
                <button class="modal-close" id="cerrar-historico" 
                        aria-label="Cerrar modal">
                    <span aria-hidden="true">√ó</span>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="modal-actions">
                    <button id="export-historico" class="btn btn-success">
                        <span class="btn-icon-text" aria-hidden="true">üì§</span>
                        Exportar JSON
                    </button>
                    <button id="import-historico" class="btn btn-info">
                        <span class="btn-icon-text" aria-hidden="true">üì•</span>
                        Importar JSON
                    </button>
                    <input id="import-file" type="file" 
                           accept="application/json,.json" 
                           class="visually-hidden" />
                    <button id="limpiar-historico" class="btn btn-danger">
                        <span class="btn-icon-text" aria-hidden="true">üóëÔ∏è</span>
                        Limpiar Hist√≥rico
                    </button>
                </div>
                
                <div id="historico-contenido" class="historico-content">
                    <!-- Contenido din√°mico -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts (RUTAS CORREGIDAS) -->
    <script src="./js/storage.js" defer></script>
    <script src="./js/generador.js" defer></script>
    <script src="./js/estadisticas.js" defer></script>
    <script src="./js/ui.js" defer></script>
    <script src="./js/app.js" defer></script>
    
    <!-- Script de inicializaci√≥n inmediata -->
    <script>
        // IMPORTANTE: Aplicar tema INMEDIATAMENTE antes de que la p√°gina se renderice
        // Esto evita el parpadeo (flash) al cambiar entre temas
        (function() {
            const temaGuardado = localStorage.getItem('tema') || 'light';
            document.documentElement.setAttribute('data-theme', temaGuardado);
        })();
        
        // Verificar que los estilos se cargaron
        document.addEventListener('DOMContentLoaded', function() {
            console.log('P√°gina cargada - verificando estilos...');
            
            // Aplicar estilos de fallback si CSS no carga
            setTimeout(function() {
                const header = document.querySelector('.main-header');
                if (header && getComputedStyle(header).position === 'static') {
                    console.log('CSS no cargado, aplicando estilos de emergencia');
                    document.body.style.padding = '16px';
                    document.body.style.background = '#f5f7fa';
                    document.body.style.fontFamily = 'Arial, sans-serif';
                }
            }, 1000);
        });
    </script>
</body>
</html>